{"version":3,"file":"index.js","sources":["../src/index.js","../src/util.js","../src/core.js","../src/map.js"],"sourcesContent":["import { version } from '../package.json';\r\nimport { on, off, trigger } from './core.js';\r\nimport * as util from './util.js';\r\nclass Binder {\r\n    constructor(obj) {\r\n        this.length = 0;\r\n        if (typeof obj === 'string') {\r\n            var els = util.query(obj);\r\n            if (els.length > 0) {\r\n                var self = this;\r\n                Array.prototype.forEach.call(els, function (el) {\r\n                    self[self.length] = el;\r\n                    self.length++;\r\n                });\r\n            }\r\n        } else if (typeof obj === 'object') {\r\n            this[0] = obj;\r\n        } else {\r\n            console.error('不支持对非object类型的数据进行事件绑定');\r\n        }\r\n    }\r\n\r\n    on() {\r\n        var args = Array.from(arguments),\r\n            i, len = this.length;\r\n        for (i = 0; i < len; i++) {\r\n            on.apply(null, [this[i]].concat(args));\r\n        }\r\n    }\r\n    off() {\r\n        var args = Array.from(arguments),\r\n            i, len = this.length;\r\n        for (i = 0; i < len; i++) {\r\n            off.apply(null, [this[i]].concat(args));\r\n        }\r\n    }\r\n    trigger() {\r\n    }\r\n}\r\n\r\nfunction E(obj){\r\n    return new Binder(obj);\r\n}\r\nE.version = version;\r\nE.on = on;\r\nE.off = off;\r\nE.trigger = trigger;\r\n\r\nexport default E;","export var isDom = obj => {\r\n    return typeof obj === 'object' && (obj instanceof window.Node || isWindow(obj));\r\n}\r\nexport var isWindow = obj => {\r\n    return typeof obj === 'object' && obj.window === obj;\r\n}\r\n\r\nexport var bind = (el, type, handler, useCapture) => {\r\n    if (typeof useCapture !== 'boolean') {\r\n        useCapture = false;\r\n    }\r\n    if (el.addEventListener) {\r\n        el.addEventListener(type, handler, useCapture);\r\n    } else if (el.attachEvent) {\r\n        el.attachEvent('on' + type, handler);\r\n    } else {\r\n        el['on' + type] = handler;\r\n    }\r\n}\r\n\r\nexport var unbind = (el, type, handler) => {\r\n    if (el.removeEventListener) {\r\n        el.removeEventListener(type, handler);\r\n    } else if (el.attachEvent) {\r\n        el.detachEvent('on' + type, handler);\r\n    } else {\r\n        el['on' + type] = null;\r\n    }\r\n}\r\n\r\nexport var fire = (el, type, w) => {\r\n}\r\n\r\nexport var query = selector => {\r\n    return document.querySelectorAll(selector);\r\n}","import ShimMap from './map.js';\r\nimport * as util from './util.js';\r\n\r\nvar $map = new ShimMap();\r\n\r\nvar getBinder = obj => {\r\n    var binder = obj.$$e || $map.get(obj);\r\n    if (!binder) {\r\n        binder = {\r\n            target: obj,\r\n            ts: new Date().getTime(),\r\n            handlers: {},\r\n            realHandler: function (event) {\r\n                return exec(this, obj, event.type, Array.from(arguments));\r\n            }\r\n        };\r\n        if (util.isDom(obj)) {\r\n            obj.$$e = binder;\r\n        }\r\n        $map.set(obj, binder);\r\n    }\r\n    return binder;\r\n}\r\n\r\nvar decomposeEventName = function (eventName) {\r\n    var namespace = \"___default___\",\r\n        index = eventName.indexOf('.');\r\n    if (index != -1) {\r\n        namespace = eventName.substr(index + 1, eventName.length);\r\n        eventName = eventName.substr(0, index);\r\n    }\r\n    return {\r\n        type: eventName,\r\n        namespace: namespace\r\n    }\r\n}\r\nvar exec = (runtimeTarget, bindingTarget, type, eventArgs) => {\r\n    if(process.env.NODE_ENV !== 'production'){\r\n        console.log(new Date().getTime());\r\n    }\r\n    var binder = bindingTarget.$$e || $map.get(bindingTarget),\r\n        handlerItem, result, ns,\r\n        events = binder.handlers[type];\r\n    for (ns in events) {\r\n        handlerItem = events[ns];\r\n        if (Array.isArray(handlerItem)) {\r\n            handlerItem.forEach(item => {\r\n                var res = item.apply(runtimeTarget, eventArgs);\r\n                if (typeof res === 'boolean') {\r\n                    result = typeof result === 'boolean' ? result && res : res;\r\n                }\r\n            })\r\n        } else {\r\n            var res = handlerItem.apply(runtimeTarget, eventArgs);\r\n            if (typeof res === 'boolean') {\r\n                result = typeof result === 'boolean' ? result && res : res;\r\n            }\r\n        }\r\n    }\r\n    if(process.env.NODE_ENV !== 'production'){\r\n        console.log(new Date().getTime());\r\n    }\r\n    return result;\r\n}\r\n\r\nexport var on = (obj, eventName, handler) => {\r\n    var typeInfo = decomposeEventName(eventName),\r\n        namespace = typeInfo.namespace,\r\n        type = typeInfo.type,\r\n        binder = getBinder(obj);\r\n    if (util.isDom(obj) && !binder.handlers[type]) {\r\n        util.bind(obj, type, binder.realHandler);\r\n    }\r\n\r\n    binder.handlers[type] = binder.handlers[type] || {};\r\n    if (namespace === '___default___') {\r\n        //顶级命名支持多次绑定，如：click\r\n        binder.handlers[type][namespace] = binder.handlers[type][namespace] || [];\r\n        binder.handlers[type][namespace].push(handler);\r\n    } else {\r\n        //含子命名空间不支持多次绑定，如：click.user\r\n        binder.handlers[type][namespace] = handler;\r\n    }\r\n}\r\n\r\nexport var off = (obj, eventName) => {\r\n    var typeInfo = decomposeEventName(eventName),\r\n        namespace = typeInfo.namespace,\r\n        type = typeInfo.type,\r\n        binder = getBinder(obj),\r\n        events = binder.handlers[type];\r\n\r\n    if (binder && events) {\r\n        if (namespace === \"___default___\") {\r\n            delete binder.handlers[type];\r\n            if (util.isDom(obj)) {\r\n                util.unbind(obj, type, binder.realHandler);\r\n            }\r\n            $map.delete(obj);\r\n        } else {\r\n            delete events[namespace];\r\n        }\r\n    }\r\n}\r\n\r\nexport var trigger = (obj, type) => {\r\n}","export default Map ? Map : class ShimMap {\r\n    constructor() {\r\n        var store = {},\r\n            keys = [],\r\n            values = [],\r\n            map = {},\r\n            hasNaNKey = false,\r\n            naNItemValue;\r\n\r\n        this.set = function (key, value) {\r\n            if (typeof key === 'string') {\r\n                store[key] = value;\r\n            } else if (typeof key === 'number' && isNaN(key)) {\r\n                naNItemValue = value;\r\n                hasNaNKey = true;\r\n            } else {\r\n                var keyIndex = keys.indexOf(key);\r\n                if (keyIndex === -1) {\r\n                    keyIndex = keys.length;\r\n                    keys.push(key);\r\n                    map[keyIndex] = values.length;\r\n                    values.push(value);\r\n                } else {\r\n                    values[map[keyIndex]] = value;\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n        this.get = function (key) {\r\n            if (typeof key === 'string') {\r\n                return store[key];\r\n            } else if (typeof key === 'number' && isNaN(key)) {\r\n                return naNItemValue;\r\n            } else {\r\n                var keyIndex = keys.indexOf(key);\r\n                return keyIndex === -1 ? undefined : values[map[keyIndex]];\r\n            }\r\n        }\r\n        this.has = function (key) {\r\n            if (typeof key === 'string') {\r\n                return store.hasOwnProperty(key);\r\n            } else if (typeof key === 'number' && isNaN(key)) {\r\n                return hasNaNKey;\r\n            } else {\r\n                var keyIndex = keys.indexOf(key);\r\n                return map.hasOwnProperty(keyIndex);\r\n            }\r\n        }\r\n        this.delete = function (key) {\r\n            if (!this.has(key)) return;\r\n            var val;\r\n            if (typeof key === 'string') {\r\n                val = store[key];\r\n                delete store[key];\r\n            } else if (typeof key === 'number' && isNaN(key)) {\r\n                hasNaNKey = false;\r\n                val = naNItemValue;\r\n                naNItemValue = undefined;\r\n            } else {\r\n                var keyIndex = keys.indexOf(key),\r\n                    valIndex = map[keyIndex];\r\n                delete map[keyIndex];\r\n                keys.splice(keyIndex, 1);\r\n                val = values.splice(valIndex, 1);\r\n            }\r\n            return val;\r\n        }\r\n        /*\r\n        this.clear = function () {\r\n            store = {};\r\n            keys.length = 0;\r\n            values.length = 0;\r\n            map = {};\r\n            hasNaNKey = false;\r\n            naNItemValue = undefined;\r\n        }\r\n        this.forEach = function (cb, context) {\r\n            if (typeof cb != 'function') return;\r\n            var self = this;\r\n            for (var key in store) {\r\n                cb.call(context, store[key], key, self);\r\n            }\r\n            for (var keyIndex in map) {\r\n                cb.call(context, values[map[keyIndex]], keys[keyIndex], self);\r\n            }\r\n        }*/\r\n    }\r\n};"],"names":["E","obj","Binder","isDom","window","Node","isWindow","bind","el","type","handler","useCapture","addEventListener","attachEvent","unbind","removeEventListener","detachEvent","query","document","querySelectorAll","selector","$map","Map","naNItemValue","store","keys","values","map","hasNaNKey","set","key","value","isNaN","keyIndex","indexOf","length","push","this","get","undefined","has","hasOwnProperty","delete","val","valIndex","splice","getBinder","binder","$$e","Date","getTime","event","exec","Array","from","arguments","util","decomposeEventName","eventName","namespace","index","substr","runtimeTarget","bindingTarget","eventArgs","process","env","NODE_ENV","log","handlerItem","result","ns","events","handlers","isArray","forEach","res","item","apply","on","typeInfo","realHandler","off","els","self","prototype","call","error","i","args","len","concat","version","trigger"],"mappings":"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"}